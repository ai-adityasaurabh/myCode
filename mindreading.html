<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mind Reader - Face Tracking</title>
<style>
    body{
        font-family: Arial, sans-serif;
        background:#111;
        color:#fff;
        text-align:center;
        margin:0;
        padding:20px;
    }
    #videoBox{
        position:relative;
        width:480px;
        margin:auto;
    }
    video{
        width:480px;
        border-radius:10px;
    }
    canvas{
        position:absolute;
        left:0; top:0;
        width:480px; height:360px;
        pointer-events:none;
    }
    #numbers{
        margin-top:20px;
        font-size:24px;
        letter-spacing:10px;
    }
    button{
        margin:10px;
        padding:10px 20px;
        font-size:18px;
        border:none;
        border-radius:8px;
        background:#0d6efd;
        color:#fff;
        cursor:pointer;
    }
    #status{
        margin-top:10px;
        font-size:16px;
        color:#0f0;
    }
    #error{
        margin-top:10px;
        font-size:16px;
        color:#f33;
    }
</style>
</head>

<body>

<h2>ðŸ§  Mind Reader â€“ Face Tracking</h2>

<div id="videoBox">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
</div>

<div id="numbers"></div>

<button onclick="startCamera()">Start Camera</button>
<button onclick="generateNumbers()">Show Numbers</button>
<button onclick="startReading()">Read Mind</button>

<div id="status"></div>
<div id="error"></div>

<!-- TensorFlow + Face Mesh -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>

<script>
let video = document.getElementById('video');
let canvas = document.getElementById('canvas');
let ctx = canvas.getContext('2d');
let model = null;
let randomNumbers = [];
let selectedNumber = null;

function log(msg){ console.log(msg); }
function status(msg){ document.getElementById("status").innerText = msg; }
function err(msg){ document.getElementById("error").innerText = msg; }

async function startCamera(){
    err("");
    status("Starting Camera...");

    try{
        const stream = await navigator.mediaDevices.getUserMedia({video:true});
        video.srcObject = stream;

        await new Promise(res=>video.onloadeddata=res);
        status("Camera Ready â€” Loading Model...");
        loadModel();
        drawLoop();

    } catch(e){
        err("Camera Error: " + e);
    }
}

async function loadModel(){
    try{
        model = await faceLandmarksDetection.createDetector(
            faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh,
            { runtime:"tfjs", refineLandmarks:true }
        );
        status("Model Loaded âœ”ï¸");
    }catch(e){
        err("Model load failed: " + e);
    }
}

async function drawLoop(){
    requestAnimationFrame(drawLoop);

    if(!model) return;

    const faces = await model.estimateFaces(video);
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(faces.length){
        const pts = faces[0].keypoints;

        ctx.fillStyle="cyan";
        pts.forEach(p=>{
            ctx.beginPath();
            ctx.arc(p.x, p.y, 1.5, 0, Math.PI*2);
            ctx.fill();
        });
    }
}

function generateNumbers(){
    status("Think about a number...");
    randomNumbers = [];

    while(randomNumbers.length < 10){
        let x = Math.floor(Math.random()*90)+10;
        if(!randomNumbers.includes(x)) randomNumbers.push(x);
    }

    selectedNumber = randomNumbers[Math.floor(Math.random()*10)];

    document.getElementById("numbers").innerText = randomNumbers.join("  ");
}

async function startReading(){
    status("Showing numbers one by oneâ€¦ à¤¦à¥‡à¤–à¥‹ à¤”à¤° à¤°à¥à¤•à¥‹ à¤œà¤¿à¤¸ number à¤ªà¤° à¤¸à¥‹à¤šà¤¾ à¤¥à¤¾!");

    let i = 0;
    let interval = setInterval(()=>{
        if(i >= randomNumbers.length){
            clearInterval(interval);
            reveal();
            return;
        }

        document.getElementById("numbers").innerText = randomNumbers[i];
        i++;
    }, 900);
}

function reveal(){
    document.getElementById("numbers").innerText = "You were thinking â†’ " + selectedNumber;
    status("Mind Read Complete ðŸ˜„");
}
</script>

</body>
</html>
