<!--
Eye Number Predictor
Single-file HTML + JS project.
Instructions: Think of a number from 1 to 10. Calibrate the gaze tracker by clicking the calibration dots. Then press START PREDICTION and look at the number you thought of. After prediction finishes, click the number you actually thought of to check accuracy.
Uses WebGazer.js (open-source gaze tracker).
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eye Number Predictor (1-10)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9ca3af;--glass: rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,#071024 0%, #0b1220 100%);color:#e6eef8}
    .container{max-width:980px;margin:36px auto;padding:24px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:20px}
    p.lead{margin:6px 0 14px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin:18px 0}
    .cell{background:var(--glass);border-radius:10px;padding:18px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;cursor:pointer;user-select:none;transition:transform .12s,box-shadow .12s}
    .cell:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(2,6,23,0.6)}
    .cell.predicted{outline:3px solid rgba(6,182,212,0.18)}
    .cell.actual{outline:3px solid rgba(34,197,94,0.18)}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    button{background:linear-gradient(90deg,var(--accent),#7dd3fc);border:none;color:#032027;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .info{margin-top:12px;color:var(--muted);font-size:14px}
    .status{margin-top:12px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:600}
    .footer{margin-top:18px;color:var(--muted);font-size:13px}
    #overlay{position:fixed;inset:0;background:rgba(2,6,23,0.7);display:flex;align-items:center;justify-content:center;z-index:60}
    .calib{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:420px}
    .dot{width:60px;height:60px;border-radius:50%;background:linear-gradient(180deg,#06b6d4,#0ea5a2);display:flex;align-items:center;justify-content:center;color:#021;cursor:pointer;font-weight:800}
    #videoPreview{display:none;border-radius:8px;overflow:hidden;margin-top:12px}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Eye Number Predictor — Think a number 1 to 10</h1>
      <p class="lead">Socho ek number 1 se 10 ke beech. <strong>Don't click a number yet.</strong> Pehle calibration karo, phir prediction start karo. Prediction ke baad aap woh number click karke check kar sakte ho.</p>

      <div class="controls">
        <button id="calibrateBtn">Start Calibration</button>
        <button id="startBtn" class="secondary" disabled>Start Prediction</button>
        <button id="shuffleBtn" class="secondary">Shuffle Numbers</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>

      <div class="info">Tip: Sit straight and keep your face visible to the webcam. Calibration helps accuracy.</div>

      <div class="grid" id="grid"></div>

      <div class="status" id="status">Status: Not calibrated</div>

      <div class="footer">
        <div class="small">Library: WebGazer.js (client-side gaze prediction). No data leaves your browser.</div>
      </div>

      <div id="videoPreview"></div>
    </div>
  </div>

  <!-- Calibration overlay -->
  <div id="overlay" style="display:none">
    <div class="card" style="padding:22px;border-radius:12px;max-width:520px">
      <h2 style="margin-top:0">Calibration</h2>
      <p class="small">Click each dot a few times to help the gaze model learn where you're looking. Jab complete ho jaye, close karo.</p>
      <div class="calib" id="calibDots"></div>
      <div style="margin-top:12px;text-align:right"><button id="closeCalib">Done</button></div>
    </div>
  </div>

  <!-- WebGazer lib -->
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>

  <script>
    // Build 1-10 grid
    const grid = document.getElementById('grid');
    let numbers = Array.from({length:10},(_,i)=>i+1);
    let predictedNumber = null;
    let actualNumber = null;

    function renderGrid(){
      grid.innerHTML='';
      numbers.forEach(n=>{
        const el = document.createElement('div');
        el.className='cell';
        el.textContent = n;
        el.dataset.num = n;
        el.addEventListener('click', ()=>{
          // User can click to confirm actual number
          document.querySelectorAll('.cell').forEach(c=>c.classList.remove('actual'));
          el.classList.add('actual');
          actualNumber = Number(el.dataset.num);
          showResult();
        });
        grid.appendChild(el);
      });
    }

    function shuffle(){
      for(let i=numbers.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));[numbers[i],numbers[j]]=[numbers[j],numbers[i]];
      }
      renderGrid();
    }

    shuffle();

    // Buttons
    const calibrateBtn = document.getElementById('calibrateBtn');
    const startBtn = document.getElementById('startBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const status = document.getElementById('status');

    // Overlay calibration dots
    const overlay = document.getElementById('overlay');
    const calibDots = document.getElementById('calibDots');

    // create 9 calibration dots
    const positions = [
      {x:0.1,y:0.1},{x:0.5,y:0.1},{x:0.9,y:0.1},
      {x:0.1,y:0.5},{x:0.5,y:0.5},{x:0.9,y:0.5},
      {x:0.1,y:0.9},{x:0.5,y:0.9},{x:0.9,y:0.9}
    ];

    positions.forEach((p,i)=>{
      const d = document.createElement('div');
      d.className='dot';
      d.textContent = i+1;
      d.addEventListener('click', ()=>{
        // when user clicks, feed webgazer with this point repeatedly to improve calibration
        const rect = d.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        // simulate multiple samples
        for(let k=0;k<30;k++){
          if(window.webgazer) webgazer.recordScreenPosition(cx,cy,'click');
        }
        d.style.transform='scale(0.9)';
        setTimeout(()=>d.style.transform='scale(1)',120);
      });
      calibDots.appendChild(d);
    });

    document.getElementById('closeCalib').addEventListener('click', ()=>{
      overlay.style.display='none';
      status.textContent='Status: Calibrated — Ready to predict';
      startBtn.disabled=false;
      // show camera feed small
      const vp = document.getElementById('videoPreview');
      if(window.webgazer && webgazer.getVideoElement()){
        vp.innerHTML='';
        const v = webgazer.getVideoElement();
        v.style.width='200px'; v.style.height='150px'; v.style.objectFit='cover'; v.style.display='block';
        vp.appendChild(v);
      }
    });

    calibrateBtn.addEventListener('click', async ()=>{
      overlay.style.display='flex';
      status.textContent='Status: Starting webcam and webgazer...';
      try{
        await initWebGazer();
        status.textContent='Status: WebGazer running — click calibration dots';
      }catch(err){
        status.textContent='Status: Could not start webcam. Allow camera and try again.';
        console.error(err);
      }
    });

    shuffleBtn.addEventListener('click', ()=>{shuffle(); status.textContent='Status: Shuffled';});
    resetBtn.addEventListener('click', ()=>{numbers=Array.from({length:10},(_,i)=>i+1);shuffle(); predictedNumber=null; actualNumber=null;document.querySelectorAll('.cell').forEach(c=>c.classList.remove('predicted','actual'));status.textContent='Status: Reset'; startBtn.disabled=true;});

    startBtn.addEventListener('click', async ()=>{
      // Predict for a short time
      if(!window.webgazer){status.textContent='WebGazer not loaded';return}
      status.textContent='Status: Predicting... Look at your number';
      document.querySelectorAll('.cell').forEach(c=>c.classList.remove('predicted','actual'));
      predictedNumber = null; actualNumber = null;

      const hits = {}; // count hits per number
      const duration = 5000; // ms
      const endTime = Date.now()+duration;

      // sampling loop
      while(Date.now() < endTime){
        const p = webgazer.getCurrentPrediction();
        if(p){
          const x = p.x; const y = p.y;
          // find element at this point
          const el = document.elementFromPoint(x,y);
          if(el && el.classList && el.classList.contains('cell')){
            const num = el.dataset.num;
            hits[num] = (hits[num]||0)+1;
          }
        }
        await new Promise(r=>setTimeout(r,60));
      }

      // choose max hit
      let maxNum=null,maxCount=0;
      for(const k in hits){
        if(hits[k] > maxCount){maxCount=hits[k]; maxNum=k}
      }

      if(maxNum){
        predictedNumber = Number(maxNum);
        const found = Array.from(document.querySelectorAll('.cell')).find(c=>Number(c.dataset.num)===predictedNumber);
        if(found) found.classList.add('predicted');
        status.textContent = `Status: Predicted — ${predictedNumber}. Click the number you actually thought of to check.`;
      } else {
        status.textContent = 'Status: Could not predict. Try better calibration and brighter lighting.';
      }

    });

    function showResult(){
      if(predictedNumber==null || actualNumber==null) return;
      const text = predictedNumber===actualNumber ? `Correct! Predicted ${predictedNumber}.` : `Wrong. Predicted ${predictedNumber}, actual ${actualNumber}.`;
      status.textContent = 'Result: '+text;
    }

    // initialize webgazer
    async function initWebGazer(){
      return new Promise((resolve,reject)=>{
        try{
          // start webgazer
          webgazer.setRegression('ridge')
            .setGazeListener(function(data,elapsed){
              // listener runs frequently; we don't use it directly here
            }).begin()
            .then(()=>{
              // hide default prediction points
              webgazer.showVideo(true).showFaceOverlay(false).showFaceFeedbackBox(false).showPredictionPoints(false);
              resolve();
            }).catch(e=>{
              reject(e);
            });
        }catch(e){reject(e)}
      });
    }

    // Safety: stop webgazer when leaving
    window.addEventListener('beforeunload', ()=>{try{webgazer && webgazer.end();}catch(e){}});

  </script>
</body>
</html>
